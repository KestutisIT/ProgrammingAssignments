$(pieChart);function pieChart(){var j=0;var k=50;var l=2;var m="#fff";var n="#ddd";var o=5;var p=3;var q=20;var r=45;var s=4;var t=20;var u=55;var v="bold 16px 'Trebuchet MS', Verdana, sans-serif";var w="bold 12px 'Trebuchet MS', Verdana, sans-serif";var x="$";var y="rgba( 0, 0, 0, .5 )";var z=5;var A=5;var B=5;var C=2;var D="#333";var E=-.5*Math.PI;var F;var G=-1;var H=0;var I=0;var J=0;var K=0;var L=0;var M=6;var N=2;var O=0;var P=0;var Q=0;var R=0;var S=[];var T=[];var U=0;var V;var W;var X;var Y;var Z;var ba=false;var bb=1;init();function init(){F=document.getElementById('chart');if(typeof F.getContext==='undefined')return;V=F.width;W=F.height;X=V/2;Y=W/2;Z=Math.min(V,W)/2*(k/100);assignTableToPieChart();$('#chartData tr.group_expanded,#chartData tr.group_collapsed').click(handleTableGroupClick)}function handleTableGroupClick(a){var b=$(this).attr('class');var c=$(this).children('td:nth-child(3)').text();var d=$(this);updateTableAfterTableGroupOrPieChartClick(d,b,c)}function handleChartClickWhenGroupsLevel(a){if(a!=-1){var b="group_collapsed";var c=$('#chartData tr.group_collapsed:eq('+a+') td:nth-child(3)').text();var d=$('#chartData tr.group_collapsed:eq('+a+')')}else{var b="group_expanded";var c='undefined';var d=null}if(j)console.log('Chart click &#39;handleChartClickWhenGroupsLevel&#39;, Slice: '+a+', label: '+c);updateTableAfterTableGroupOrPieChartClick(d,b,c)}function updateTableAfterTableGroupOrPieChartClick(c,d,e){var f=false;var g="closed";var h=-1;if(d.indexOf('group_expanded')!==-1){h=101;if(c!=null){c.attr('class','group_collapsed')}globalChangeAllNextChildsTo="closed"}else if(d.indexOf('group_collapsed')!==-1){h=102;if(c!=null){c.attr('class','group_expanded')}globalChangeAllNextChildsTo="open"}var i=globalChangeAllNextChildsTo;if(j){console.log('click handleTableGroupClick, clickedTrClass:'+d+' clickedTrLabel:'+e+' [ cANCT Set: '+globalChangeAllNextChildsTo+' ],  <Case: '+h+'>')}$('#chartData tr.group_expanded,#chartData tr.group_collapsed,#chartData tr.element_expanded,#chartData tr.element_collapsed').each(function(){var a=$(this).attr('class');var b=$(this).children('td:nth-child(3)').text();h=0;if(a.indexOf('group_expanded')!==-1||a.indexOf('group_collapsed')!==-1){if(globalChangeAllNextChildsTo=="closed"){h=10;$(this).attr('class','group_collapsed');i="closed"}else{if(e!=b){h=11;$(this).attr('class','group_collapsed');i="closed"}else{h=12;f=true;i="open"}}}else if(a.indexOf('element_expanded')!==-1||a.indexOf('element_collapsed')!==-1){h=20;if(i=="open"){h=21;$(this).attr('class','element_expanded')}else if(i=="closed"){h=22;$(this).attr('class','element_collapsed')}}if(j){console.log('current tr class: '+a+' --> '+$(this).attr('class')+' [ cANCT: '+i+' ]  <Case: '+h+'>, curr label: '+b)}});assignTableToPieChart()}function assignTableToPieChart(){O=0;G=-1;H=0;I=0;Q=0;U=0;S=[];T=[];ba=false;clearInterval(R);clearInterval(L);var b=$('#chartData tr.group_expanded').size();var c="";if(b==0){c="#chartData tr.group_collapsed td";bb=1}else{c="#chartData tr.element_expanded td";bb=2}var d=0;var e=0;var f="#000000";if(j){console.log('<ass.T.ToPieChart> Selector: [['+c+']], totalOpenGroups: '+b)}$(c).each(function(){e++;if(e==1){S[d]=[]}else if(e==2){f=$(this).children('div').css('background-color');if(f===undefined){f="#000000"}if(j>=2){console.log('TD #2: '+$(this).html()+' Extracted color: + '+f)}if(rgb=f.match(/rgb\((\d+), (\d+), (\d+)/)){T[d]=[rgb[1],rgb[2],rgb[3]]}else if(hex=f.match(/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/)){T[d]=[parseInt(hex[1],16),parseInt(hex[2],16),parseInt(hex[3],16)]}else{alert("Error: Colour could not be determined! Please specify table colours using the format '#xxxxxx'");return}}else if(e==3){S[d]['label']=$(this).text()}else if(e==5){var a=parseFloat($(this).text());U+=a;a=a.toFixed(2);S[d]['value']=a}else if(e==6){d++;e=0}$(this).data('slice',d);$(this).data('depthInTable',bb);$(this).hover(handleTableMouseOver,function(){});if(b!=0){$(this).click(handleTableOpenGroupTdElementClick)}});var g=0;for(var h in S){S[h]['startAngle']=2*Math.PI*g;S[h]['endAngle']=2*Math.PI*(g+(S[h]['value']/U));g+=S[h]['value']/U}drawChartWithIntro();$('#chart').hover(processMouse,function(){});$('#chart').click(handleChartClick)}function processMouse(a){$('#chart').mousemove(handleChartMouseOver)}function handleChartMouseOver(a){if(ba){var b=a.pageX-this.offsetLeft;var c=a.pageY-this.offsetTop;var d=b-X;var e=c-Y;var f=Math.sqrt(Math.pow(Math.abs(d),2)+Math.pow(Math.abs(e),2));if(f<=Z){var g=Math.atan2(e,d)-E;if(g<0)g=2*Math.PI+g;for(var h in S){if(g>=S[h]['startAngle']&&g<=S[h]['endAngle']){toggleSlice(h);return}}}}}function handleChartClick(a){var b=a.pageX-this.offsetLeft;var c=a.pageY-this.offsetTop;var d=b-X;var e=c-Y;var f=Math.sqrt(Math.pow(Math.abs(d),2)+Math.pow(Math.abs(e),2));if(f<=Z){var g=Math.atan2(e,d)-E;if(g<0)g=2*Math.PI+g;for(var h in S){if(g>=S[h]['startAngle']&&g<=S[h]['endAngle']){if(bb==2){if(ba){toggleSliceOnChartClick(h)}}else if(bb==1){handleChartClickWhenGroupsLevel(h)}return}}}if(bb==1){if(ba){pushIn()}}else if(bb==2){handleChartClickWhenGroupsLevel(-1)}}function handleTableMouseOver(a){if(ba){if(bb==$(this).data('depthInTable')){var b=$(this).data('slice');toggleSlice(b)}}}function handleTableOpenGroupTdElementClick(a){if(ba){var b=$(this).data('slice');if(b==G){pushIn()}else{pushIn();startPullOut(b)}}}function toggleSlice(a){if(a==G){}else{pushIn();startPullOut(a)}}function toggleSliceOnChartClick(a){if(a==G){}else{pushIn();startPullOut(a)}}function startPullOut(a){if(G==a)return;G=a;H=0;I=0;J=q;K=r-6;clearInterval(L);L=setInterval(function(){animatePullOut(a)},t);var b=null;if(bb==1){$('#chartData tr.group_collapsed').removeClass('highlight');b=$('#chartData tr.group_collapsed:eq('+(a)+')')}else if(bb==2){$('#chartData tr.element_expanded').removeClass('highlight');b=$('#chartData tr.element_expanded:eq('+(a)+')')}b.addClass('highlight')}function animatePullOut(a){if(I%2==0){H+=s;if(H>=K){if(I!=0){K-=(o/I)}I++}}else{H-=(s);if(H<=J){J+=(o/I);I++}}if(I>=p*2){clearInterval(L);return}drawChart()}function pushIn(){G=-1;H=0;clearInterval(L);drawChart();$('#chartData tr.element_expanded').removeClass('highlight')}function drawChart(){var a=F.getContext('2d');a.clearRect(0,0,V,W);for(var b in S){if(b!=G)drawSlice(a,b)}if(G!=-1)drawSlice(a,G)}function getSlicePercentageMultiplier(a,b,c){var d=2*Math.PI*c;var e=Math.abs(b-a);var f=2*Math.PI*c*e/360;var g=Math.ceil(d/f);return g}function getNextSlicePercentage(a,b){var c=a+b;if(c>100){c=100}return c}function drawChartWithIntro(){var a=F.getContext('2d');a.clearRect(0,0,V,W);O=-1;P=S.length;drawNextSliceWithIntro(a,O)}function drawNextSliceWithIntro(a,b){b++;if(b>=P){if(j)console.log("drawing is finished from 'drawNextSliceWithIntro'");ba=true;return}else{clearInterval(R);Q=0;var c=getSlicePercentageMultiplier((S[b]['startAngle']*180),(S[b]['endAngle']*180),Z);var d=N*c;R=setInterval(function(){drawSliceWithIntro(a,b,d)},M)}}function drawSlice(a,b){var c=S[b]['startAngle']+E;var d=S[b]['endAngle']+E;if(b==G){var e=(c+d)/2;var f=H*easeOut(H/r,.8);startX=X+Math.cos(e)*f;startY=Y+Math.sin(e)*f;a.fillStyle='rgb('+T[b].join(',')+')';a.textAlign="center";a.font=v;a.fillText(S[b]['label'],X+Math.cos(e)*(Z+r+u),Y+Math.sin(e)*(Z+r+u));a.font=w;a.fillText(x+S[b]['value']+" ("+(parseInt(S[b]['value']/U*100+.5))+"%)",X+Math.cos(e)*(Z+r+u),Y+Math.sin(e)*(Z+r+u)+20);a.shadowOffsetX=z;a.shadowOffsetY=A;a.shadowBlur=B}else{startX=X;startY=Y}var g=a.createLinearGradient(0,0,V*.75,W*.75);g.addColorStop(0,n);g.addColorStop(1,'rgb('+T[b].join(',')+')');a.beginPath();a.moveTo(startX,startY);a.arc(startX,startY,Z,c,d,false);a.lineTo(startX,startY);a.closePath();a.fillStyle=g;a.shadowColor=(b==G)?y:"rgba( 0, 0, 0, 0 )";a.fill();a.shadowColor="rgba( 0, 0, 0, 0 )";if(b==G){a.lineWidth=C;a.strokeStyle=D}else{a.lineWidth=l;a.strokeStyle=m}a.stroke()}function drawSliceWithIntro(a,b,c){if(b>=P){if(j)console.log("drawing is finished from 'drawSliceWithIntro'");ba=true;return}Q=getNextSlicePercentage(Q,c);var d=S[b]['startAngle']+E;var e=S[b]['endAngle']+E;currentEndAngle=d+(Math.abs(e-d)/100*Q);startX=X;startY=Y;var f=a.createLinearGradient(0,0,V*.75,W*.75);f.addColorStop(0,n);f.addColorStop(1,'rgb('+T[b].join(',')+')');a.beginPath();a.moveTo(startX,startY);a.arc(startX,startY,Z,d,currentEndAngle,false);a.lineTo(startX,startY);a.closePath();a.fillStyle=f;a.shadowColor=(b==G)?y:"rgba( 0, 0, 0, 0 )";a.fill();a.shadowColor="rgba( 0, 0, 0, 0 )";a.lineWidth=l;a.strokeStyle=m;a.stroke();if(Q>=100){clearInterval(R);drawNextSliceWithIntro(a,b)}}function easeOut(a,b){return(Math.pow(1-a,b)+1)}};